<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wordle by Koray</title>
  <style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        text-align: center;
    }
    .seite_ueberschrift {
        text-align: center;
    }
    .letter-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
    }
    .letter-box {
        width: 60px;
        height: 60px;
        border: 2px solid gray; 
        font-size: 32px;
        line-height: 50px;
        text-align: center;
        user-select: none;
    }
  </style>
</head>
<body>
  <div style="display: flex; gap: 10px; text-align: center; justify-content: center;">
    <h1 class="seite_ueberschrift">WORDLE</h1>
    <h1 style="color: gray;">by Koray</h1>
  </div>

  <div class = "letter-container">
    <input class="letter-box" type="text" maxlength="1"></input>
    <input class="letter-box" type="text" maxlength="1"></input>
    <input class="letter-box" type="text" maxlength="1"></input>
    <input class="letter-box" type="text" maxlength="1"></input>
    <input class="letter-box" type="text" maxlength="1"></input>
  </div>
  <h1 id="wortheute">Platzhalter</h1>
  <h1 id="wortheute_check">Platzhalter</h1>

  <script>
let wortliste = [];
let wort_today = "";

function getDailyIndex(wordlistlength) {
  const today = new Date();
  const seed_str = today.toISOString().split("T")[0];
  let seed = 0;
  for (let i = 0; i < seed_str.length; i++) {
    seed += seed_str.charCodeAt(i);
  }
  return seed % wordlistlength;
}

fetch("wortliste.txt")
  .then(response => response.text())
  .then(text => {
    wortliste = text.split("\n").map(wort => wort.trim().toLowerCase()).filter(wort => wort.length === 5);
    let index_today = getDailyIndex(wortliste.length);
    wort_today = wortliste[index_today];
    document.getElementById("wortheute").textContent = wort_today;

    setupInputListeners();
  });

function setupInputListeners() {
  const alleInputs = document.querySelectorAll(".letter-box");
  const inputs = Array.from(alleInputs).slice(-5); // NUR die NEUE Zeile

  inputs.forEach((input, index) => {
    input.addEventListener("input", () => {
      if (input.value.length === 1 && index < inputs.length - 1) {
        inputs[index + 1].focus();
      }
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && input.value === "" && index > 0) {
        inputs[index - 1].focus();
      }

      if (e.key === "Enter") {
        let eingabe = "";
        inputs.forEach(i => eingabe += i.value);
        eingabe = eingabe.toLowerCase();
        let wort_check = [-1, -1, -1, -1, -1];

        if (eingabe.length < 5) {
          alert("Wort muss 5 lang sein");
          return;
        }
        if (eingabe === wort_today) {
          alert("du bist es junge");
          return;
        }
        if (!wortliste.includes(eingabe)) {
          alert("Kein echtes Wort");
          return;
        }
        else{
            // muss noch geändert werden, sodass buchstaben richtig und falsch angezeigt werden
            // check every letter
            let haeufigkeit = {};
            // haeufigkeit dictionary für input erstellen
            inputs.forEach(input => {
              const buchstabe = input.value.toLowerCase();
              if (haeufigkeit[buchstabe]) {
                haeufigkeit[buchstabe]++;
              } else {
                if (wort_today.includes(buchstabe)) {
                  haeufigkeit[buchstabe] = 1;
                } else {
                  haeufigkeit[buchstabe] = 0;
                }
              }
            })
            // Prüfe buchstaben einzeln
            inputs.forEach(
              (input, index) => {
                const buchstabe = input.value.toLowerCase();
                const vergleich_buchstabe = wort_today[index].toLowerCase();
                // Prüfe ob buchstabe richtige stelle
                if (buchstabe === vergleich_buchstabe) {
                  // 1 = grün
                  wort_check[index] = 1;
                  haeufigkeit[buchstabe]--;
                }
                // Prüfe ob buchstabe in wort
                else if (haeufigkeit[buchstabe] > 0) {
                  wort_check[index] = 2;
                  haeufigkeit[buchstabe]--;
                } else {
                  wort_check[index] = 0;
                }
              }
            )
            document.getElementById("wortheute_check").textContent = wort_check;
        }
        // Felder einfärben und fixieren
        inputs.forEach((input, index) => {
          const farbe = wort_check[index] === 1 ? "green"
                      : wort_check[index] === 2 ? "gold"
                      : "gray";
          
          input.style.backgroundColor = farbe
          input.disabled = true
        })

        // Neues Eingabefeld erstellen und in body einfügen
        const neueZeile = document.createElement("div");
        neueZeile.classList.add("letter-container");

        for (let i = 0; i < 5; i++) {
          const neuesInput = document.createElement("input");
          neuesInput.classList.add("letter-box");
          neuesInput.setAttribute("type", "text");
          neuesInput.setAttribute("maxlength", "1");
          neueZeile.appendChild(neuesInput);
        }

        document.body.appendChild(neueZeile)
        setupInputListeners();

        inputs.forEach(i => i.value = "");
        inputs[0].focus();
      }
    });
  });
}
</script>
</body>
</html>